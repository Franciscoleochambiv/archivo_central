import{f as a,o as s,a as x,u as C,Z as D,w as $,b as o,i as g,F as i,m as p,t as c,l as h,y as m}from"./app-Bl8UmmZP.js";import{_ as O}from"./AuthenticatedLayout-BQNGlJ7t.js";import{E as _}from"./exceljs.min-DAZjMUQn.js";import{S as y}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-D2MtjczB.js";import"./Chat-CXiqISL9.js";import"./Ia-CXDqMw2d.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";const j={class:"flex h-screen bg-gray-50"},B={class:"w-1/4 p-6 border-r border-gray-300 bg-white shadow-md rounded-lg"},F={class:"mb-6"},I=["value"],M={class:"grid grid-cols-1 gap-4 mb-6"},N=["value"],V=["value"],U={class:"flex-1 p-6 overflow-auto"},z={class:"w-full text-sm text-left text-gray-500 bg-white rounded-lg shadow-sm"},A={class:"text-xs text-gray-700 uppercase bg-gray-100"},L={data(){return{tiposReporte:[{label:"General de Expedientes",value:"oficina"},{label:"Por Oficina",value:"oficina"}],filtros:{oficina_id:"",entidad_id:"1"},oficinas:[],entidades:[],dataReportes:[],headers:[]}},methods:{async cargarMaestros(){const l=await m.get("/api/oficinaexcel");this.oficinas=l.data;const r=await m.get("/api/entidades");this.entidades=r.data},async fetchReporte(){try{const l=await m.get(`/api/reportes/${this.reporteSeleccionado}`,{params:this.filtros});console.log(l.data),this.dataReportes=l.data,this.headers=Object.keys(this.dataReportes[0]||{})}catch{y.fire("Error","No se pudo cargar el reporte","error")}},async exportarReporte(){try{const l=await m.get(`/api/reportes/${this.reporteSeleccionado}`,{params:this.filtros});console.log("estamos en exportar excel ");const r=l.data;if(!r||r.length===0){y.fire("Sin datos","No hay informaciÃ³n para exportar","info");return}const t=new _.Workbook,e=t.addWorksheet("Reporte"),n=new Date,f=`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()} ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}:${n.getSeconds().toString().padStart(2,"0")}`;e.addRow(["Municipalidad Distrital de Colquemarca "]),e.addRow(["Fecha de Impresion: ",f]),e.addRow([]);const u=e.addRow(["REPORTE DE EXPEDIENTES REGISTRADOS"]);e.mergeCells(`A${u.number}:V${u.number}`),u.getCell(1).alignment={horizontal:"center"},u.getCell(1).font={bold:!0,size:14},u.eachCell(d=>{d.font={bold:!0,size:12}}),e.addRow([]);const R={type:"pattern",pattern:"solid",fgColor:{argb:"F2DCDB"}},v={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},w=Object.keys(r[0]);e.addRow(w).eachCell(d=>{d.fill=R,d.font={bold:!0},d.alignment={horizontal:"center",wrapText:!0},d.border=v}),r.forEach(d=>{e.addRow(w.map(E=>d[E]))}),e.columns.forEach(d=>{d.width=20});const S=await t.xlsx.writeBuffer(),k=new Blob([S],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=document.createElement("a");b.href=URL.createObjectURL(k),b.download=`Reporte_${this.reporteSeleccionado}.xlsx`,b.click()}catch(l){console.error("Error al generar Excel:",l),y.fire("Error","No se pudo generar el reporte","error")}}},mounted(){this.cargarMaestros()}},P=Object.assign(L,{__name:"Index",setup(l){return(r,t)=>(s(),a(i,null,[x(C(D),{title:"Reportes Documentales"}),x(O,null,{default:$(()=>[o("div",j,[o("div",B,[t[11]||(t[11]=o("h1",{class:"text-2xl font-bold text-gray-800 mb-6"},"Seleccionar Reporte",-1)),o("div",F,[t[5]||(t[5]=o("label",{class:"block text-sm font-semibold text-gray-600 mb-2"},"Tipo de Reporte",-1)),g(o("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.reporteSeleccionado=e),class:"text-sm w-full px-4 py-2 border border-red-300 rounded-lg focus:outline-none focus:border-red-500 hover:shadow"},[(s(!0),a(i,null,p(r.tiposReporte,e=>(s(),a("option",{key:e.value,value:e.value},c(e.label),9,I))),128))],512),[[h,r.reporteSeleccionado]])]),o("div",M,[o("div",null,[t[7]||(t[7]=o("label",{class:"block text-sm font-semibold text-gray-600 mb-2"},"Oficina",-1)),g(o("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.filtros.oficina_id=e),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-red-500"},[t[6]||(t[6]=o("option",{value:""},"Todas las oficinas",-1)),(s(!0),a(i,null,p(r.oficinas,e=>(s(),a("option",{key:e.id,value:e.id},c(e.nombre),9,N))),128))],512),[[h,r.filtros.oficina_id]])]),o("div",null,[t[9]||(t[9]=o("label",{class:"block text-sm font-semibold text-gray-600 mb-2"},"Entidad",-1)),g(o("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.filtros.entidad_id=e),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-red-500"},[t[8]||(t[8]=o("option",{value:""},"Todas las entidades",-1)),(s(!0),a(i,null,p(r.entidades,e=>(s(),a("option",{key:e.id,value:e.id},c(e.nombre),9,V))),128))],512),[[h,r.filtros.entidad_id]])])]),o("button",{onClick:t[3]||(t[3]=(...e)=>r.fetchReporte&&r.fetchReporte(...e)),class:"w-full bg-red-400 hover:bg-red-600 text-white py-3 rounded-md font-semibold shadow-md mb-2"}," Cargar Reporte "),o("button",{onClick:t[4]||(t[4]=(...e)=>r.exportarReporte&&r.exportarReporte(...e)),class:"w-full bg-gray-400 hover:bg-gray-700 rounded-md flex items-center justify-center py-2 text-xs text-white"},t[10]||(t[10]=[o("span",null,"Exportar Excel",-1)]))]),o("div",U,[o("table",z,[o("thead",A,[o("tr",null,[(s(!0),a(i,null,p(r.headers,e=>(s(),a("th",{key:e,class:"py-2 px-4"},c(e),1))),128))])]),o("tbody",null,[(s(!0),a(i,null,p(r.dataReportes,(e,n)=>(s(),a("tr",{key:n,class:"border-b hover:bg-gray-50"},[(s(!0),a(i,null,p(Object.values(e),f=>(s(),a("td",{key:f,class:"py-2 px-4"},c(f),1))),128))]))),128))])])])])]),_:1})],64))}}),ee=T(P,[["__scopeId","data-v-52b40255"]]);export{ee as default};
