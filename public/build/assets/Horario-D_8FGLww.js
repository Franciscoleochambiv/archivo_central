import{S as d}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{f as i,o as n,b as s,g as c,F as x,m as b,t as m,i as g,p as f,q as k,e as h}from"./app-DpVbqR-c.js";import{_ as y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const w={props:{clientToken:String},data(){return{horaActual:"",dni:"",nombreCompleto:"",usuarioValido:!1,tokenEntrada:"",tokenValidado:!1,buscando:!1,resumenAsistencia:[]}},created(){this.$nextTick(()=>{this.tokenValidado&&this.$refs.inputDni&&this.$refs.inputDni.focus()}),this.actualizarHora(),setInterval(this.actualizarHora,1e3);const t=this.obtenerCookie("token_ingreso");this.tokenValidado=t!==null&&t===this.clientToken},methods:{actualizarHora(){const t=new Date;this.horaActual=t.toLocaleTimeString("es-PE",{hour:"2-digit",minute:"2-digit",second:"2-digit"})},obtenerCookie(t){const e=document.cookie.split(";");for(let a of e){const[u,o]=a.trim().split("=");if(u===t)return o}return null},guardarToken(){const t=new Date;t.setFullYear(t.getFullYear()+1),document.cookie=`token_ingreso=${this.tokenEntrada}; path=/; expires=${t.toUTCString()}; SameSite=Strict`,console.log("Token guardado:",this.tokenEntrada),d.fire({icon:"success",title:"Token guardado correctamente",timer:1500,showConfirmButton:!1}).then(()=>{location.reload()})},async buscarUsuario(){if(this.usuarioValido=!1,this.buscando=!0,this.nombreCompleto="",this.dni.length!==8){this.buscando=!1,d.fire({icon:"warning",title:"DNI invÃ¡lido",text:"Debe tener exactamente 8 dÃ­gitos."});return}try{const e=await(await fetch(`/api/personaldni/${this.dni}`)).json();this.nombreCompleto=`${e.nombres} ${e.apellidos}`,this.device_user_id=e.device_user_id,this.usuarioValido=!0,this.$nextTick(()=>{var o;(o=this.$refs.btnRegistrar)==null||o.focus()});const u=await(await fetch("/api/asistencia/resumen",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_user_id:this.device_user_id,fecha:new Date().toISOString().split("T")[0]})})).json();console.log(u),this.resumenAsistencia=u.resumen||[]}catch(t){d.fire({icon:"error",title:"Error",text:"No se encontrÃ³ device id del usuario."}).then(()=>{location.reload()}),console.error(t)}finally{this.buscando=!1}},async registrarIngreso(){try{const t={device_user_id:this.device_user_id},e=await fetch("/api/asistencia/registra",{method:"POST",headers:{"Content-Type":"application/json","X-CLIENT-TOKEN":this.clientToken},body:JSON.stringify(t)}),a=await e.json();e.ok?d.fire({icon:"success",title:"Registrado",text:a.message||"Ingreso registrado exitosamente",timer:2500}).then(()=>{location.reload()}):d.fire({icon:"error",title:"Error",text:a.message||"Error al registrar ingreso"}).then(()=>{location.reload()}),this.usuarioValido=!1,this.dni="",this.nombreCompleto=""}catch(t){d.fire({icon:"error",title:"Error",text:"No se pudo conectar al servidor."}),this.$nextTick(()=>{var e;(e=this.$refs.inputDni)==null||e.focus()}),console.error(t)}}}},v={class:"relative min-h-screen bg-gray-100 flex flex-col justify-center items-center px-4"},T={key:0,class:"absolute top-4 right-4 bg-white border rounded p-4 shadow w-64 text-left"},C={class:"text-sm text-gray-800 space-y-1"},_={class:"bg-white p-8 rounded-xl shadow-2xl max-w-md w-full text-center mt-6"},S={class:"text-5xl font-bold text-red-400 mb-8"},V={key:0},D={key:1},E={key:0,class:"text-xl font-semibold text-gray-800 mb-4"},I={key:1,class:"flex justify-center mt-4"};function N(t,e,a,u,o,l){return n(),i("div",v,[e[9]||(e[9]=s("img",{src:"/asset/lolo.jpeg",alt:"Logo de la Municipalidad",class:"max-w-xs mx-auto mb-4"},null,-1)),e[10]||(e[10]=s("h2",{class:"text-xl font-semibold text-gray-800 mb-2 text-center"},"Control de Asistencia",-1)),o.resumenAsistencia.length?(n(),i("div",T,[e[5]||(e[5]=s("h3",{class:"text-sm font-bold text-gray-700 mb-2"},"ðŸ“ Resumen de hoy",-1)),s("ul",C,[(n(!0),i(x,null,b(o.resumenAsistencia,(r,p)=>(n(),i("li",{key:p},[s("strong",null,m(r.etiqueta)+":",1),h(" "+m(r.hora),1)]))),128))])])):c("",!0),s("div",_,[s("h1",S,m(o.horaActual),1),o.tokenValidado?(n(),i("div",D,[g(s("input",{ref:"inputDni","onUpdate:modelValue":e[2]||(e[2]=r=>o.dni=r),placeholder:"Ingrese DNI",maxlength:"8",class:"w-full text-center border border-gray-300 px-4 py-3 rounded text-xl mb-4 focus:outline-none focus:border-gray-500 focus:ring-1 focus:ring-gray-400",onKeyup:e[3]||(e[3]=k((...r)=>l.buscarUsuario&&l.buscarUsuario(...r),["enter"]))},null,544),[[f,o.dni]]),o.nombreCompleto?(n(),i("div",E,[e[7]||(e[7]=s("span",{class:"text-red-500 mr-2 hover:shadow-md hover:shadow-red-200"},null,-1)),h(" "+m(o.nombreCompleto),1)])):c("",!0),o.buscando?(n(),i("div",I,e[8]||(e[8]=[s("svg",{class:"animate-spin h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)]))):c("",!0),o.usuarioValido?(n(),i("button",{key:2,ref:"btnRegistrar",onClick:e[4]||(e[4]=(...r)=>l.registrarIngreso&&l.registrarIngreso(...r)),class:"px-4 py-2 bg-red-200 dark:bg-red-800/50 rounded hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition"}," Registrar Ingreso ",512)):c("",!0)])):(n(),i("div",V,[e[6]||(e[6]=s("h3",{class:"text-xl font-semibold text-red-800 mb-4"},"ðŸ”’ Ingresar token de acceso",-1)),g(s("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.tokenEntrada=r),placeholder:"Token de acceso",class:"border px-4 py-2 rounded w-full mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400"},null,512),[[f,o.tokenEntrada]]),s("button",{onClick:e[1]||(e[1]=(...r)=>l.guardarToken&&l.guardarToken(...r)),class:"bg-red-400 text-white px-6 py-2 rounded hover:bg-red-700 transition w-full"}," Guardar ")]))]),e[11]||(e[11]=s("div",{class:"mt-10 text-sm text-gray-500 text-center"}," Sfsystem ",-1))])}const O=y(w,[["render",N],["__scopeId","data-v-82701741"]]);export{O as default};
