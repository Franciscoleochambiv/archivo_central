import{f as l,o as a,b as t,g as u,i as f,p as g,F as x,m,y as b,t as k,n as E}from"./app-C4I9CGfi.js";import{S as h}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{E as C}from"./exceljs.min-Ca61ECEY.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";const N={data(){return{fase:"solicitar",buscando:!1,dni:"",email:"",token:"",dniVerificado:"",filteredResults:[],fechaInicio:"",fechaFin:"",resultados:[],currentPage:1,totalPages:1,mostrarModal:!1}},computed:{visiblePages(){const i=[],e=Math.max(1,this.currentPage-2),c=Math.min(this.totalPages,this.currentPage+2);for(let d=e;d<=c;d++)i.push(d);return i},showEllipsisBefore(){return this.visiblePages[0]>1},showEllipsisAfter(){return this.visiblePages[this.visiblePages.length-1]<this.totalPages}},methods:{fetchReporte(i){this.consultar(i)},async solicitarToken(){try{this.buscando=!0,await b.post("/api/stoken",{dni:this.dni,email:this.email}),h.fire({title:"Â¡Correcto!",text:"Token Enviado al correo exitosamente",icon:"success",confirmButtonColor:"#16a34a"}),this.buscando=!1,this.fase="validar"}catch(i){h.fire({title:"Â¡Error!",text:"Error Solicitando token "+i,icon:"error",confirmButtonColor:"#f43f5e"})}},async validarToken(){try{const i=await b.post("/api/vtoken",{token:this.token});this.dniVerificado=i.data.dni,this.fase="consulta"}catch(i){h.fire({title:"Â¡Error!",text:"Token Invalido "+i,icon:"error",confirmButtonColor:"#f43f5e"})}},async consultar(i=1){try{const e=await b.get(`/api/reporte-personal?page=${i}`,{params:{dni:this.dniVerificado,inicio:this.fechaInicio,fin:this.fechaFin}});this.resultados=e.data.data,this.currentPage=e.data.current_page,this.totalPages=e.data.last_page,this.headers=Object.keys(e.data.data[0]||{}),this.mostrarModal=!0,console.log(e.data)}catch(e){h.fire({title:"Â¡Error!",text:"Error al cargar reporte "+e,icon:"error",confirmButtonColor:"#f43f5e"})}},async exportarAsistenciaDiariaExcel(){try{const e=(await b.get("/api/reporte-personal-excel",{params:{dni:this.dniVerificado,inicio:this.fechaInicio,fin:this.fechaFin}})).data;if(console.log(e),e.length===0)throw new Error("No se encontraron registros de asistencia diaria.");const c=new C.Workbook,d=c.addWorksheet("Asistencia Diaria"),r=new Date,n=`${r.getDate().toString().padStart(2,"0")}/${(r.getMonth()+1).toString().padStart(2,"0")}/${r.getFullYear()} ${r.getHours().toString().padStart(2,"0")}:${r.getMinutes().toString().padStart(2,"0")}:${r.getSeconds().toString().padStart(2,"0")}`;d.addRow(["Municipalidad Distrital de Colquemarca"]),d.addRow(["Fecha: ",n]),d.addRow([]),d.addRow(["Tipo: ",this.tipoContrato]),d.mergeCells("A3:M3");const o=d.getCell("A3");o.value="REPORTE DE ASISTENCIA DIARIA DESDE: "+this.fechaInicio+" HASTA:"+this.fechaFin,o.alignment={horizontal:"center"},o.font={bold:!0,size:14},d.addRow(["FECHA","DEVICE_USER_ID","NOMBRE_COMPLETO","MORNING_IN","LUNCH_OUT","AFTERNOON_IN","AFTERNOON_OUT","LATITUD","LONGITUD","Morning_in_out_of_range","Lunch_out_out_of_range","afternoon_in_out_of_range","afternoon_out_out_of_range"]).eachCell(s=>{s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"F2DCDB"}},s.font={bold:!0},s.alignment={horizontal:"center",vertical:"middle",wrapText:!0},s.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),d.columns=[{width:12},{width:15},{width:30},{width:15},{width:15},{width:15},{width:15},{width:12},{width:12},{width:8},{width:8},{width:8},{width:8}],e.forEach(s=>{d.addRow([s.fecha,s.device_user_id,s.nombre_completo,s.morning_in||"N/A",s.lunch_out||"N/A",s.afternoon_in||"N/A",s.afternoon_out||"N/A",s.latitud||"N/A",s.longitud||"N/A",s.morning_in_out_of_range||"N/A",s.lunch_out_out_of_range||"N/A",s.afternoon_in_out_of_range||"N/A",s.afternoon_out_out_of_range||"N/A"]).eachCell(v=>{v.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},v.alignment={wrapText:!0}})});const p=await c.xlsx.writeBuffer(),_=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),y=document.createElement("a");y.href=URL.createObjectURL(_),y.download="Asistencia_Diaria.xlsx",y.click()}catch(i){h.fire({title:"Â¡Error!",text:"Error al exportar el reporte de asistencia diaria../ No hay registros "+i,icon:"error",confirmButtonColor:"#f43f5e"})}}}},T={class:"relative min-h-screen bg-gray-100 flex flex-col justify-center items-center px-4"},R={class:"bg-white p-8 rounded-xl shadow-2xl max-w-md w-full text-center mt-6"},S={key:0},P={key:0,class:"flex justify-center mt-4"},D={key:1},I={key:2},M={class:"flex space-x-4 mb-6"},F={class:"flex space-x-4 mb-6"},B={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},O={class:"bg-white rounded-lg p-6 max-w-6xl w-full relative"},V={class:"overflow-x-auto"},U={id:"categoria",class:"w-full text-sm text-left text-gray-500 dark:text-gray-400"},L={class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"},j={class:"pagination-controls mt-4 flex justify-center space-x-2"},z=["disabled"],H={key:0,class:"px-4 py-2"},G=["onClick"],W={key:1,class:"px-4 py-2"},q=["disabled"];function J(i,e,c,d,r,n){return a(),l("div",T,[e[20]||(e[20]=t("img",{src:"/asset/lolo.jpeg",alt:"Logo de la Municipalidad",class:"max-w-xs mx-auto mb-4"},null,-1)),e[21]||(e[21]=t("h2",{class:"text-xl font-semibold text-gray-800 mb-2 text-center"},"Solicitar Acceso",-1)),t("div",R,[r.fase==="solicitar"?(a(),l("div",S,[e[13]||(e[13]=t("h3",{class:"text-xl font-semibold text-red-800 mb-4"},"ðŸ”’ Ingresar Los datos para Obtener Acceso",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.dni=o),placeholder:"DNI",class:"border px-4 py-2 rounded w-full mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400"},null,512),[[g,r.dni]]),f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.email=o),placeholder:"Correo ElectrÃ³nico",class:"border px-4 py-2 rounded w-full mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400"},null,512),[[g,r.email]]),t("button",{onClick:e[2]||(e[2]=(...o)=>n.solicitarToken&&n.solicitarToken(...o)),class:"bg-red-400 text-white px-6 py-2 rounded hover:bg-red-700 transition w-full"}," Solicitar token "),r.buscando?(a(),l("div",P,e[12]||(e[12]=[t("svg",{class:"animate-spin h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)]))):u("",!0)])):u("",!0),r.fase==="validar"?(a(),l("div",D,[e[14]||(e[14]=t("h3",{class:"text-xl font-semibold text-red-800 mb-4"},"ðŸ”’ Validar Token",-1)),f(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.token=o),placeholder:"Token recibido",class:"border px-4 py-2 rounded w-full mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400"},null,512),[[g,r.token]]),t("button",{onClick:e[4]||(e[4]=(...o)=>n.validarToken&&n.validarToken(...o)),class:"bg-red-400 text-white px-6 py-2 rounded hover:bg-red-700 transition w-full"}," Validar ")])):u("",!0),r.fase==="consulta"?(a(),l("div",I,[e[16]||(e[16]=t("label",{class:"block text-sm font-semibold text-gray-600 mb-2"},"Fecha Inicio",-1)),f(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=o=>r.fechaInicio=o),class:"text-sm w-full max-w-lg px-4 py-2 border border-red-300 rounded-lg focus:outline-none focus:border-red-500 hover:shadow mx-1"},null,512),[[g,r.fechaInicio]]),e[17]||(e[17]=t("label",{class:"block text-sm font-semibold text-gray-600 mb-2"},"Fecha Fin",-1)),f(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=o=>r.fechaFin=o),class:"text-sm w-full max-w-lg px-4 py-2 border border-red-300 rounded-lg focus:outline-none focus:border-red-500 hover:shadow mx-1"},null,512),[[g,r.fechaFin]]),e[18]||(e[18]=t("h3",{class:"text-xl font-semibold text-red-800 mb-4"},null,-1)),t("div",M,[t("button",{onClick:e[7]||(e[7]=(...o)=>n.consultar&&n.consultar(...o)),class:"w-full bg-red-400 hover:bg-red-600 text-white py-3 rounded-md font-semibold shadow-md mb-6 mb-4"}," Cargar Reporte ")]),t("div",F,[t("button",{onClick:e[8]||(e[8]=(...o)=>n.exportarAsistenciaDiariaExcel&&n.exportarAsistenciaDiariaExcel(...o)),class:"w-full bg-gray-400 hover:bg-gray-700 rounded-md flex items-center space-x-2 py-2 text-xs text-white"},e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 3h18M3 21h18M3 12h18"})],-1),t("span",null,"Exportar Excel",-1)]))])])):u("",!0)]),r.mostrarModal?(a(),l("div",B,[t("div",O,[e[19]||(e[19]=t("h3",{class:"text-xl font-semibold text-gray-800 mb-4"},"Reporte de Horarios",-1)),t("button",{onClick:e[9]||(e[9]=o=>r.mostrarModal=!1),class:"absolute top-2 right-2 text-gray-500 hover:text-red-600"}," âœ• "),t("div",V,[t("table",U,[t("thead",L,[t("tr",null,[(a(!0),l(x,null,m(i.headers,o=>(a(),l("th",{scope:"col",key:o,class:"py-3 px-6"},k(o),1))),128))])]),t("tbody",null,[(a(!0),l(x,null,m(r.resultados,(o,w)=>(a(),l("tr",{key:w,class:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[(a(!0),l(x,null,m(Object.values(o),p=>(a(),l("td",{key:p,class:"text-xs py-2 px-6"},k(p),1))),128))]))),128))])])]),t("div",j,[t("button",{onClick:e[10]||(e[10]=o=>n.fetchReporte(r.currentPage-1)),disabled:r.currentPage===1,class:"px-4 py-2 bg-red-100 dark:bg-red-800/50 text-gray-800 rounded hover:bg-gray-400"}," Anterior ",8,z),n.showEllipsisBefore?(a(),l("span",H,"...")):u("",!0),(a(!0),l(x,null,m(n.visiblePages,o=>(a(),l("button",{key:o,onClick:w=>n.fetchReporte(o),class:E(["px-4 py-2 rounded",r.currentPage===o?"bg-red-400 text-white":"bg-gray-300"])},k(o),11,G))),128)),n.showEllipsisAfter?(a(),l("span",W,"...")):u("",!0),t("button",{onClick:e[11]||(e[11]=o=>n.fetchReporte(r.currentPage+1)),disabled:r.currentPage===r.totalPages,class:"px-4 py-2 bg-red-100 dark:bg-red-800/50 text-gray-800 rounded hover:bg-gray-400"}," Siguiente ",8,q)])])])):u("",!0),e[22]||(e[22]=t("div",{class:"mt-10 text-sm text-gray-500 text-center"}," Sfsystem ",-1))])}const ee=A(N,[["render",J]]);export{ee as default};
