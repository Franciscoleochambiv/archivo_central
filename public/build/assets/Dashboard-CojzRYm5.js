import{_ as c}from"./AuthenticatedLayout-QePhxG6N.js";import{f as n,o as i,a as l,u as m,Z as u,w as p,b as t,e as d,n as g,F as f}from"./app-CfL62DiI.js";import{S as s}from"./sweetalert2.esm.all-BQIkj5Wb.js";import"./ApplicationLogo-CM4Kn49N.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Chat-Dt6yl0WE.js";import"./Ia-C-VnDNBP.js";const h={class:"py-6 px-4 sm:p-6 md:py-10 md:px-8"},x={class:"max-w-4xl mx-auto grid grid-cols-1 lg:max-w-5xl lg:gap-x-20 lg:grid-cols-2"},b={class:"bg-white p-4 mt-4 mb-4 ml-4 mr-4 rounded-lg"},w={key:0},v={key:1,class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"},y=["disabled"],k={props:["auth"],data(){return{botonActivo:!1,mensajeBoton:"",telefono:"",otp:"",monto:600,estado:!0,emailValue:"",importacion:!0,email:"",saldos:{ingresos:0,egresos:0},form:{id_meta:"",cod_meta:"",meta:"",fecha:"",cantidad:"",tipo_doc:"",tipo_combustible:"",nro_doc:"",detalle:"",userid:""},sugerencias:[]}},async mounted(){this.auth&&this.auth.user&&this.auth.user.name&&(this.emailValue=this.auth.user.email),console.log(this.auth.user.id),await this.verificarEstadoBotonPago(),this.$page.props.auth.user||(window.location.href="/login")},methods:{async mostrarModalPago(){const{value:a}=await s.fire({title:"Pago por Yape: S/ "+this.monto/100,html:`
      <div class="relative">
        <input
          type="text"
          class="w-54 rounded-lg border-gray-300 focus:border-red-500 focus:ring-indigo-500 p-4 pe-12 text-sm shadow-sm mb-3"
          placeholder="Número de contacto"
          id="telefono"
        />
      </div>
      <div class="relative">
        <input
          type="text"
          class="w-54 rounded-lg border-gray-300 focus:border-red-500 focus:ring-indigo-500 p-4 pe-12 text-sm shadow-sm mb-3"
          placeholder="Código de Aprobación"
          id="otp"
        />
      </div>
      <div class="relative">
        <input
          type="text"
          class="w-54 rounded-lg border-gray-300 focus:border-red-500 focus:ring-indigo-500 p-4 pe-12 text-sm shadow-sm"
          placeholder="DNI (8 caracteres)"
          id="dni"
        />
      </div>
    `,focusConfirm:!1,preConfirm:()=>{const o=document.getElementById("telefono").value,e=document.getElementById("otp").value,r=document.getElementById("dni").value;return o?!e||e.length!==6?(s.showValidationMessage("Por favor, ingresa el código de aprobación"),!1):!r||r.length!==8?(s.showValidationMessage("El DNI debe tener exactamente 8 caracteres"),!1):{telefono:o,otp:e,dni:r}:(s.showValidationMessage("Por favor, ingresa el número de contacto"),!1)}});if(a)try{this.estado=!1;const o=await axios.post("/api/pagos/procesar",{telefono:a.telefono,otp:a.otp,dni:a.dni,monto:this.monto});if(console.log(o),o.data.code==="YPCHK0010")s.fire("Error",o.data.user_message||"Hubo un error procesando el pago.","error");else if(o.data.object==="token"){s.fire({title:"Éxito",text:"Token de Yape generado: "+o.data.id+"...se procede a realizar el cargo ",icon:"success",timer:5e3,showConfirmButton:!1});try{const e=await axios.post("/api/pagos/generarCargo",{amount:this.monto,currency_code:"PEN",email:o.data.email,source_id:o.data.id,description:"PAGO MENSUAL "+o.data.client.ip,dni:a.dni});if(console.log(e.data),e.data&&e.data.outcome&&e.data.outcome.code){if(e.data.outcome.code==="AUT0000"){const r=await axios.post("/api/pagos/registrarPago",{monto:this.monto,token:o.data.id,usuario_id:this.auth.user.id});s.fire("Éxito",e.data.outcome.merchant_message+"  "+e.data.outcome.user_message,"success")}}else s.fire("Error en la transacción",e.data.user_message||"No se pudo realizar el cargo. Inténtalo nuevamente.","error")}catch(e){console.log(e),s.fire("Error en la transacción",e.response_pago.data.user_message||"No se pudo realizar el cargo. Inténtalo nuevamente.","error")}}else s.fire("Error",o.data.user_message||"No se pudo procesar el token. Inténtalo nuevamente.","error");this.estado=!0}catch(o){console.log(o),s.fire("Error",o||"No se pudo procesar el token. Inténtalo nuevamente.","error")}},async verificarEstadoBotonPago(){try{const a=await axios.get("/api/pagos/estado-boton");console.log(a.data),this.botonActivo=a.data.activo,this.mensajeBoton=a.data.mensaje,localStorage.setItem("botonActivo",JSON.stringify(a.data.activo)),localStorage.setItem("mensajeBoton",a.data.mensaje)}catch(a){console.error("Error al verificar el estado del botón de pago:",a)}},async procesarPago(){try{const a=await axios.post("/api/pagos/procesar",{telefono:telefono.value,otp:otp.value,monto:monto.value});alert("Pago realizado con éxito. Token: "+a.data.token)}catch(a){console.error("Error al procesar el pago:",a),alert("No se pudo procesar el pago: "+a.response.data.error)}},toggleEstado(){this.botonActivo=!this.botonActivo}}},I=Object.assign(k,{__name:"Dashboard",setup(a){return(o,e)=>(i(),n(f,null,[l(m(u),{title:"Dashboard"}),l(c,null,{default:p(()=>[t("main",h,[t("div",x,[e[2]||(e[2]=t("div",{class:"relative p-3 col-start-1 row-start-1 flex flex-col-reverse rounded-lg bg-gradient-to-t from-black/75 via-black/0 sm:bg-none sm:row-start-2 sm:p-0 lg:row-start-1"},[t("h1",{class:"mt-1 text-lg font-semibold text-white sm:text-slate-900 md:text-2xl dark:sm:text-white"},"Sistema de Archivo Central "),t("p",{class:"text-sm leading-4 font-medium text-white sm:text-slate-500 dark:sm:text-slate-400"},"Entire house")],-1)),t("div",b,[o.estado?(i(),n("div",w)):(i(),n("div",v,e[1]||(e[1]=[t("div",{class:"ml-2 animate-spin rounded-full h-20 w-20 border-t-8 border-blue-500"},null,-1)])))]),e[3]||(e[3]=t("dl",{class:"mt-4 text-xs font-medium flex items-center row-start-2 sm:mt-1 sm:row-start-3 md:mt-2.5 lg:row-start-2"},[t("dt",{class:"sr-only"},"Reviews"),t("dd",{class:"text-indigo-600 flex items-center dark:text-indigo-400"},[t("svg",{width:"24",height:"24",fill:"none","aria-hidden":"true",class:"mr-1 stroke-current dark:stroke-indigo-500"},[t("path",{d:"m12 5 2 5h5l-4 4 2.103 5L12 16l-5.103 3L9 14l-4-4h5l2-5Z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]),t("span",null,[d("4.89 "),t("span",{class:"text-slate-400 font-normal"},"(128)")])]),t("dt",{class:"sr-only"},"Location"),t("dd",{class:"flex items-center"},[t("svg",{width:"2",height:"2","aria-hidden":"true",fill:"currentColor",class:"mx-3 text-slate-300"},[t("circle",{cx:"1",cy:"1",r:"1"})]),t("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"mr-1 text-slate-400 dark:text-slate-500","aria-hidden":"true"},[t("path",{d:"M18 11.034C18 14.897 12 19 12 19s-6-4.103-6-7.966C6 7.655 8.819 5 12 5s6 2.655 6 6.034Z"}),t("path",{d:"M14 11a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"})]),d(" Cusco Peru ")])],-1)),e[4]||(e[4]=t("div",{class:"mt-4 col-start-1 row-start-3 self-center sm:mt-0 sm:col-start-2 sm:row-start-2 sm:row-span-2 lg:mt-6 lg:col-start-1 lg:row-start-3 lg:row-end-4"},[t("button",{type:"button",class:"bg-red-600 text-white text-sm leading-6 font-medium py-2 px-3 rounded-lg"},"Disponible")],-1)),e[5]||(e[5]=t("p",{class:"mt-4 text-sm leading-6 col-start-1 sm:col-span-2 lg:mt-6 lg:row-start-4 lg:col-span-1 dark:text-slate-400"},[t("br")],-1)),e[6]||(e[6]=t("img",{src:"/asset/yape.jpg",alt:"Logo de Yape",class:"mx-auto max-w-full h-auto w-20 h-20"},null,-1)),e[7]||(e[7]=t("br",null,null,-1)),t("button",{type:"button",onClick:e[0]||(e[0]=(...r)=>o.mostrarModalPago&&o.mostrarModalPago(...r)),class:g([o.botonActivo?"bg-red-600":"bg-gray-400","bg-blue-400 text-white text-sm leading-6 font-medium py-2 px-3 rounded-lg"]),disabled:!o.botonActivo},"COSTO MENSUAL: 50",10,y)])])]),_:1})],64))}});export{I as default};
